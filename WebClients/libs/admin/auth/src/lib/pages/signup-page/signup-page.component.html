<form nz-form [formGroup]="form" (ngSubmit)="submitForm()">
    <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="email" nzRequired
            >E-mail</nz-form-label
        >
        <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="emailErrorTpl">
            <input
                data-cy="email"
                nz-input
                formControlName="email"
                id="email"
            />
            <ng-template #emailErrorTpl let-control>
                <span
                    data-cy="email-required-error"
                    *ngIf="control.hasError('empty')"
                >
                    E-mail is required!
                </span>
                <span
                    data-cy="email-invalid-error"
                    *ngIf="control.hasError('email')"
                >
                    The input is not valid E-mail!
                </span>
            </ng-template>
        </nz-form-control>
    </nz-form-item>
    <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="password" nzRequired
            >Password</nz-form-label
        >
        <nz-form-control
            [nzSm]="14"
            [nzXs]="24"
            [nzErrorTip]="passwordErrorTpl"
        >
            <input
                data-cy="password"
                nz-input
                type="password"
                id="password"
                formControlName="password"
                (ngModelChange)="updateConfirmValidator()"
            />
            <ng-template #passwordErrorTpl let-control>
                <span
                    data-cy="password-required-error"
                    *ngIf="control.hasError('empty')"
                >
                    Password should not be empty!
                </span>
                <span
                    data-cy="password-min-length-error"
                    *ngIf="control.hasError('minlength')"
                >
                    Password should not be less than 6 characters!
                </span>
            </ng-template>
        </nz-form-control>
    </nz-form-item>
    <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="checkPassword" nzRequired
            >Confirm Password</nz-form-label
        >
        <nz-form-control
            [nzSm]="14"
            [nzXs]="24"
            [nzErrorTip]="confirmPasswordErrorTpl"
        >
            <input
                data-cy="confirm-password"
                nz-input
                type="password"
                formControlName="checkPassword"
                id="checkPassword"
            />
            <ng-template #confirmPasswordErrorTpl let-control>
                <span
                    data-cy="confirm-password-required"
                    *ngIf="control.hasError('required')"
                >
                    Please confirm your password!
                </span>
                <span
                    data-cy="confirm-password-not-match-error"
                    *ngIf="control.hasError('confirm')"
                >
                    Two passwords that you enter is inconsistent!
                </span>
            </ng-template>
        </nz-form-control>
    </nz-form-item>
    <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="firstName" nzRequired>
            First Name
        </nz-form-label>
        <nz-form-control
            [nzSm]="14"
            [nzXs]="24"
            [nzErrorTip]="firstNameErrorTpl"
        >
            <input
                data-cy="first-name"
                nz-input
                id="firstName"
                formControlName="firstName"
            />
            <ng-template #firstNameErrorTpl let-control>
                <span
                    data-cy="first-name-required-error"
                    *ngIf="control.hasError('empty')"
                >
                    Please input your First Name!
                </span>
            </ng-template>
        </nz-form-control>
    </nz-form-item>
    <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="lastName" nzRequired>
            Last Name
        </nz-form-label>
        <nz-form-control
            [nzSm]="14"
            [nzXs]="24"
            [nzErrorTip]="lastNameErrorTpl"
        >
            <input
                data-cy="last-name"
                nz-input
                id="lastName"
                formControlName="lastName"
            />
            <ng-template #lastNameErrorTpl let-control>
                <span
                    data-cy="last-name-required-error"
                    *ngIf="control.hasError('empty')"
                >
                    Please input your Last Name!
                </span>
            </ng-template>
        </nz-form-control>
    </nz-form-item>
    <nz-form-item nz-row class="register-area">
        <nz-form-control [nzSpan]="14" [nzOffset]="6">
            <label data-cy="agree" nz-checkbox formControlName="agree">
                <span
                    >I have read the
                    <a
                        data-cy="agreement-modal-open"
                        (click)="
                            $event.preventDefault();
                            $event.stopPropagation();
                            isAgreementVisible = true
                        "
                        >agreement</a
                    ></span
                >
            </label>
        </nz-form-control>
    </nz-form-item>

    <nz-alert
        data-cy="submit-error"
        nz-row
        *ngIf="errorMessage"
        nzType="error"
        nzCloseable
        nzMessage="Error"
        [nzDescription]="errorMessage"
        style="margin-bottom: 25px;"
    >
    </nz-alert>

    <nz-form-item nz-row class="register-area">
        <nz-form-control [nzSpan]="14" [nzOffset]="6">
            <button
                data-cy="submit"
                [nzLoading]="isSubmitting"
                [disabled]="form.invalid || !form.value['agree']"
                nz-button
                nzType="primary"
            >
                Register
            </button>
        </nz-form-control>
    </nz-form-item>
</form>

<nz-modal
    [nzClosable]="false"
    [(nzVisible)]="isAgreementVisible"
    nzTitle="Agreement"
    [nzFooter]="modalFooter"
>
    <div data-cy="agreement-modal">
        <p>Welcome</p>
    </div>
    <ng-template #modalFooter>
        <button
            data-cy="agreement-modal-close"            
            nz-button
            nzType="primary"
            (click)="isAgreementVisible = false"
        >
            OK
        </button>
    </ng-template>
</nz-modal>
